{% extends "base.html" %} {% block content %}

<p>
    <a href="/">Back to Home</a>
</p>
<h4>Test</h4>
<form action="/category/index" method="POST" enctype="multipart/form-data">
    <div class="form-group">
        <input type="text" name="title" class="form-control" id="title" /></div>
    <div class="form-group">
        <input type="text" name="desc" class="form-control" /></div>
    <div class="form-group">
        <input type="file" name="images" class="form-control" multiple="" /></div>
    <input type="submit" class="btn btn-primary" />
</form>
<div class="category">
    {% for category in categorys %}
    <h1> {{ category.name }} {{ category.title }} </h1>
    <p> {{ category.description }} {{ category.desc }} </p>

    <a class="btn btn-danger btn-link delete_btn" data-id="{{category._id}}" href="#">DELETE</a>
    <a class="btn btn-primary btn-link update_btn" data-id="{{category._id}}" href="#">Update</a>
    {% for img in category.img %}
    <img src="/category/{{category._id}}/{{img}}" alt="{{img}} " height="150"> {% endfor %} {% endfor %}
</div>
<script>
    function jajax(url, type, data) {
        $.ajax({
            url: 'http://localhost:5000/' + url,
            contentType: "application/json; charset=utf-8",
            method: type,
            data: JSON.stringify(data)
        }).done(function (data) {
            console.log('SUCCEEEEEEED', data);
        }).fail(function (jqXHR, textStatus, err) {
            console.log('Error: ' + err);
        }).always(function () {
            console.log('ALWAYS ');
        });
    }


    $(document).ready(function () {
        $(".delete_btn").on("click", function () {
            id = $(this).attr('data-id');
            jajax('category/index', 'DELETE', { 'id': id })
        })
        $(".update_btn").on("click", function () {
            id = $(this).attr('data-id');
            value = $("#title").val();
            jajax('category/update', 'POST', { 'id': id, 'data': { title: value } })
        })

    });

</script>


{% endblock %}